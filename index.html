<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç†Šç‘¶çš„ç”Ÿæ—¥å°æ¸¸æˆ ğŸ‰</title>
<style>
body, html { margin:0; padding:0; overflow:hidden; font-family:sans-serif; background: linear-gradient(to top, #ffeef6, #fff7f9);}
#gameArea { position: relative; width: 100vw; height: 100vh; touch-action: none; overflow:hidden;}
#player { position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; background: url('https://i.imgur.com/6bZ3J8p.png') no-repeat center/contain; transition: left 0.1s linear; }
.item { position: absolute; width: 40px; height: 40px; background-size: contain; cursor:pointer; transition: transform 0.2s; }
.item:hover { transform: scale(1.2);}
#message { position:absolute; width:100%; top:40%; text-align:center; font-size:2rem; color:#ff4081; display:none; animation: float 2s ease forwards; }
@keyframes float { 0%{opacity:0; transform:translateY(50px);} 100%{opacity:1; transform:translateY(0);} }
#cake { position:absolute; width:80px; height:80px; bottom:15%; left:50%; transform:translateX(-50%); background:url('https://i.imgur.com/7wQGJ6c.png') no-repeat center/contain; display:none; cursor:pointer; }
#progress { position:absolute; top:5%; left:5%; width:90%; height:20px; background:#eee; border-radius:10px; }
#progressBar { width:0%; height:100%; background: linear-gradient(90deg,#ff4081,#ff80ab); border-radius:10px; transition: width 0.2s; }
.confetti { position:absolute; width:10px; height:10px; background:gold; opacity:0.8; pointer-events:none; }
audio { display:none; }
</style>
</head>
<body>
<div id="gameArea">
  <div id="player"></div>
  <div id="message">ğŸ‰ Happy Birthday ç†Šç‘¶! ğŸ‰</div>
  <div id="cake"></div>
  <div id="progress"><div id="progressBar"></div></div>
</div>

<!-- éŸ³æ•ˆ -->
<audio id="popSound" src="https://www.myinstants.com/media/sounds/pop.mp3"></audio>
<audio id="cakeSound" src="https://www.myinstants.com/media/sounds/birthday-candle.mp3"></audio>
<audio id="bgMusic" src="https://www.myinstants.com/media/sounds/happy-birthday.mp3" loop autoplay></audio>

<script>
const gameArea = document.getElementById('gameArea');
const player = document.getElementById('player');
const message = document.getElementById('message');
const cake = document.getElementById('cake');
const progressBar = document.getElementById('progressBar');
const popSound = document.getElementById('popSound');
const cakeSound = document.getElementById('cakeSound');
const bgMusic = document.getElementById('bgMusic');

let collected = 0;
const totalItems = 8;
let items = [];
let confettis = [];

// éšæœºç”Ÿæˆitem
function createItem() {
  const item = document.createElement('div');
  item.classList.add('item');
  if(collected < 5) item.style.backgroundImage = "url('https://i.imgur.com/9w1hXkD.png')"; // æ°”çƒ
  else item.style.backgroundImage = "url('https://i.imgur.com/hX4oE0N.png')"; // ç¤¼ç‰©
  item.style.left = Math.random()*90 + 'vw';
  item.style.top = '-50px';
  gameArea.appendChild(item);
  items.push(item);
}

// ä¸‹è½åŠ¨ç”»
function dropItems() {
  items.forEach(item=>{
    const top = parseFloat(item.style.top);
    if(top < window.innerHeight-60) {
      item.style.top = top + 2 + 'px';
    } else {
      gameArea.removeChild(item);
      items = items.filter(i=>i!==item);
      createItem();
    }
  });
  requestAnimationFrame(dropItems);
}

// æ£€æµ‹ç¢°æ’
function checkCollision() {
  items.forEach(item=>{
    const playerRect = player.getBoundingClientRect();
    const itemRect = item.getBoundingClientRect();
    if(!(playerRect.right<itemRect.left || playerRect.left>itemRect.right || playerRect.bottom<itemRect.top || playerRect.top>itemRect.bottom)) {
      collected++;
      popSound.currentTime = 0; popSound.play();
      progressBar.style.width = (collected/totalItems*100)+'%';
      gameArea.removeChild(item);
      items = items.filter(i=>i!==item);
      if(collected<totalItems) createItem();
      else showCake();
    }
  });
  requestAnimationFrame(checkCollision);
}

// æ˜¾ç¤ºè›‹ç³•å’Œç¥ç¦
function showCake(){
  cake.style.display = 'block';
}

// ç‚¹å‡»è›‹ç³•æ˜¾ç¤ºç¥ç¦ + å½©å¸¦
cake.addEventListener('click', ()=>{
  cakeSound.currentTime = 0; cakeSound.play();
  message.style.display = 'block';
  launchConfetti();
});

// æ§åˆ¶ç©å®¶å·¦å³
gameArea.addEventListener('touchstart', e=>{
  const x = e.touches[0].clientX;
  const left = parseFloat(player.style.left);
  if(x < window.innerWidth/2) {
    player.style.left = Math.max(0, left-30) + 'px';
  } else {
    player.style.left = Math.min(window.innerWidth-50, left+30) + 'px';
  }
});

// åˆå§‹åŒ–
for(let i=0;i<totalItems;i++) createItem();
dropItems();
checkCollision();

// å½©å¸¦/çƒŸèŠ±æ•ˆæœ
function launchConfetti(){
  for(let i=0;i<50;i++){
    const conf = document.createElement('div');
    conf.classList.add('confetti');
    conf.style.left = Math.random()*100+'vw';
    conf.style.top = '-10px';
    conf.style.background = `hsl(${Math.random()*360}, 100%, 50%)`;
    gameArea.appendChild(conf);
    confettis.push(conf);
    animateConfetti(conf);
  }
}

function animateConfetti(conf){
  let y = -10;
  const speed = 2+Math.random()*3;
  const sway = Math.random()*4;
  function fall(){
    y += speed;
    conf.style.top = y+'px';
    conf.style.left = parseFloat(conf.style.left) + Math.sin(y/10)*sway + 'px';
    if(y < window.innerHeight){
      requestAnimationFrame(fall);
    } else {
      gameArea.removeChild(conf);
    }
  }
  fall();
}
</script>
</body>
</html>
